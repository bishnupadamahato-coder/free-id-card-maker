<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student ID Card Generator - Habra High School</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Add jsPDF library for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
            padding: 20px;
        }
        .a4-container {
            width: 210mm;
            min-height: 297mm;
            margin: 0 auto;
            padding: 15mm;
            background-color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .id-card-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        .id-card {
            width: 85.725mm; /* 3.375 inches */
            height: 53.975mm; /* 2.125 inches */
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 10px;
            position: relative;
            display: flex;
            flex-direction: column;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .school-header {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            padding: 5px 0;
            background-color: #007bff;
            border-radius: 5px;
            color: white;
        }
        .school-logo-container {
            margin-right: 10px;
        }
        .school-logo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid white;
        }
        .school-info {
            text-align: center;
        }
        .school-name {
            font-weight: bold;
            font-size: 16px;
            margin: 0;
        }
        .school-address {
            font-size: 10px;
            margin: 0;
        }
        .session-year {
            font-size: 10px;
            text-align: center;
            margin: 3px 0;
            font-weight: bold;
        }
        .id-card-body {
            display: flex;
            flex-grow: 1;
            font-size: 14px; /* Increased text size */
        }
        .student-photo-container {
            width: 35%;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 3px;
        }
        .student-photo {
            width: 100%;
            aspect-ratio: 3/4;
            background-color: #eee;
            margin-bottom: 5px;
            border: 1px solid #ddd;
            object-fit: cover;
        }
        .student-info {
            width: 65%;
            padding: 3px 8px;
        }
        .info-row {
            margin-bottom: 6px;
            display: flex;
        }
        .info-label {
            width: 75px;
            font-weight: bold;
            font-size: 12px;
        }
        .info-value {
            flex-grow: 1;
            font-size: 12px;
            border-bottom: 1px dotted #999;
            min-height: 16px;
        }
        .id-card-footer {
            text-align: center;
            font-size: 9px;
            margin-top: auto;
            padding-top: 3px;
            border-top: 1px solid #ddd;
        }
        .signature {
            font-size: 10px;
            text-align: right;
            margin-top: 5px;
            font-style: italic;
        }
        .upload-btn {
            font-size: 9px;
            padding: 2px 5px;
            margin-top: 5px;
        }
        .controls {
            margin-bottom: 20px;
        }
        @media print {
            body, .a4-container {
                background-color: white;
                box-shadow: none;
                padding: 0;
            }
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="a4-container" id="a4Container">
        <h2 class="text-center mb-4 no-print">Student ID Card Generator</h2>
        
        <div class="controls no-print mb-4">
            <div class="row">
                <div class="col-md-6">
                    <label for="schoolLogo" class="form-label">Upload School Logo</label>
                    <input type="file" class="form-control" id="schoolLogo" accept="image/*">
                </div>
                <div class="col-md-6 d-flex align-items-end">
                    <button class="btn btn-primary mt-2" id="generateAll">Generate All ID Cards</button>
                    <button class="btn btn-success mt-2 ms-2" onclick="window.print()">Print ID Cards</button>
                    <button class="btn btn-info mt-2 ms-2" id="downloadBtn">Download as Image</button>
                    <button class="btn btn-warning mt-2 ms-2" id="downloadPdf">Download as PDF</button>
                </div>
            </div>
        </div>
        
        <div class="id-card-container" id="idCardContainer">
            <!-- ID cards will be generated here -->
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Initialize jsPDF
        const { jsPDF } = window.jspdf;
        
        $(document).ready(function() {
            // Initialize 6 ID cards
            for (let i = 1; i <= 6; i++) {
                createIdCard(i);
            }
            
            // Handle school logo upload
            $('#schoolLogo').change(function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        $('.school-logo-img').attr('src', event.target.result).css('display', 'block');
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Generate all button
            $('#generateAll').click(function() {
                for (let i = 1; i <= 6; i++) {
                    updateStudentData(i);
                }
            });
            
            // Download as image button
            $('#downloadBtn').click(function() {
                downloadAsImage();
            });
            
            // Download as PDF button
            $('#downloadPdf').click(function() {
                downloadAsPdf();
            });
        });
        
        function createIdCard(cardNumber) {
            const cardHtml = `
                <div class="id-card" id="idCard${cardNumber}">
                    <div class="school-header">
                        <div class="school-logo-container">
                            <img src="" class="school-logo school-logo-img" alt="School Logo" style="display: none;">
                        </div>
                        <div class="school-info">
                            <p class="school-name">HABRA HIGH SCHOOL</p>
                            <p class="school-address">P.O: Habra Dist : North 24 pgs</p>
                        </div>
                    </div>
                    <div class="session-year">SESSION: 2025</div>
                    <div class="id-card-body">
                        <div class="student-photo-container">
                            <img src="" class="student-photo" id="studentPhoto${cardNumber}" alt="Student Photo">
                            <input type="file" class="form-control upload-btn student-photo-upload no-print" data-card="${cardNumber}" accept="image/*">
                        </div>
                        <div class="student-info">
                            <div class="info-row">
                                <div class="info-label">Name:</div>
                                <div class="info-value" id="name${cardNumber}"></div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Class:</div>
                                <div class="info-value" id="class${cardNumber}"></div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">DOB:</div>
                                <div class="info-value" id="dob${cardNumber}"></div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Blood:</div>
                                <div class="info-value" id="blood${cardNumber}"></div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Guardian:</div>
                                <div class="info-value" id="guardian${cardNumber}"></div>
                            </div>
                            <div class="info-row">
                                <div class="info-label">Phone:</div>
                                <div class="info-value" id="phone${cardNumber}"></div>
                            </div>
                        </div>
                    </div>
                    <div class="signature">H.M/TIC: ___________</div>
                    <div class="id-card-footer">
                        <div class="form-group no-print">
                            <button class="btn btn-sm btn-primary update-btn" data-card="${cardNumber}">Update Data</button>
                        </div>
                        <div>Student ID: HHS-${String(cardNumber).padStart(3, '0')}</div>
                    </div>
                </div>
            `;
            
            $('#idCardContainer').append(cardHtml);
            
            // Handle student photo upload
            $(`.student-photo-upload[data-card="${cardNumber}"]`).change(function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        $(`#studentPhoto${cardNumber}`).attr('src', event.target.result);
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Handle update button click
            $(`.update-btn[data-card="${cardNumber}"]`).click(function() {
                updateStudentData(cardNumber);
            });
        }
        
        function updateStudentData(cardNumber) {
            const name = prompt(`Enter student ${cardNumber} name:`) || `Student ${cardNumber}`;
            const studentClass = prompt(`Enter student ${cardNumber} class:`) || `Class ${cardNumber}`;
            const dob = prompt(`Enter student ${cardNumber} date of birth:`) || `01/01/2010`;
            const blood = prompt(`Enter student ${cardNumber} blood group:`) || `O+`;
            const guardian = prompt(`Enter student ${cardNumber} guardian name:`) || `Parent ${cardNumber}`;
            const phone = prompt(`Enter student ${cardNumber} phone number:`) || `9876543210`;
            
            $(`#name${cardNumber}`).text(name);
            $(`#class${cardNumber}`).text(studentClass);
            $(`#dob${cardNumber}`).text(dob);
            $(`#blood${cardNumber}`).text(blood);
            $(`#guardian${cardNumber}`).text(guardian);
            $(`#phone${cardNumber}`).text(phone);
        }
        
        function downloadAsImage() {
            $('.no-print').hide();
            
            html2canvas(document.getElementById('a4Container')).then(function(canvas) {
                $('.no-print').show();
                
                const link = document.createElement('a');
                link.download = 'Habra_High_School_ID_Cards.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }
        
        function downloadAsPdf() {
            $('.no-print').hide();
            
            // Create a new PDF document
            const pdf = new jsPDF('p', 'mm', 'a4');
            
            // Capture each ID card individually
            const promises = [];
            for (let i = 1; i <= 6; i++) {
                promises.push(
                    new Promise((resolve) => {
                        html2canvas(document.getElementById(`idCard${i}`)).then(canvas => {
                            const imgData = canvas.toDataURL('image/png');
                            resolve({ imgData, index: i });
                        });
                    })
                );
            }
            
            // When all cards are captured
            Promise.all(promises).then(results => {
                $('.no-print').show();
                
                // Sort by card number
                results.sort((a, b) => a.index - b.index);
                
                // Add each card to the PDF
                let x = 15, y = 15;
                results.forEach((card, idx) => {
                    if (idx > 0 && idx % 2 === 0) {
                        // Move to next row after 2 cards
                        x = 15;
                        y += 55;
                    }
                    
                    pdf.addImage(card.imgData, 'PNG', x, y, 85.725, 53.975);
                    
                    if (idx % 2 === 0) {
                        // Move right for next card
                        x += 90;
                    }
                    
                    // Add new page after 6 cards (3 rows)
                    if ((idx + 1) % 6 === 0 && (idx + 1) < results.length) {
                        pdf.addPage();
                        x = 15;
                        y = 15;
                    }
                });
                
                // Save the PDF
                pdf.save('Habra_High_School_ID_Cards.pdf');
            });
        }
    </script>
</body>
</html>